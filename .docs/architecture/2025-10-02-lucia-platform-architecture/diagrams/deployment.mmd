---
config:
  theme: dark
---
%% Deployment Diagram - Home Lab Topology
%% Audience: Platform engineers | Purpose: Illustrate runtime placement and connectivity
flowchart TB
  classDef host fill:#1f77b4,color:#ffffff,stroke:#85c0f9,stroke-width:2px;
  classDef cluster fill:#2ca02c,color:#0a0a0a,stroke:#98df8a,stroke-width:2px;
  classDef observ fill:#9467bd,color:#ffffff,stroke:#c5b0d5,stroke-width:2px;
  classDef infra fill:#17becf,color:#0a0a0a,stroke:#9edae5,stroke-width:2px;
  classDef ai fill:#ff7f0e,color:#0a0a0a,stroke:#ffbb78,stroke-width:2px;
  classDef optional stroke-dasharray: 6 3,stroke:#f7f7f7,color:#f7f7f7;

  subgraph HOME_HOST["Home Assistant Host (Raspberry Pi / VM)"]
    haCore["Home Assistant Core"]:::host
    luciaComponent["Lucia Conversation Plugin"]:::host
  end

  subgraph LUCIA_CLUSTER["Lucia Platform Cluster"]
    appHost["lucia.AppHost (.NET Aspire)"]:::cluster
    luciaApi["Lucia API Service (HTTPS)"]:::cluster
    agentHost["Lucia Agent Host Worker"]:::cluster
  end

  subgraph OBSERVABILITY["Observability"]
    otelCollector["OpenTelemetry Collector"]:::observ
    logsStack["Grafana / Loki Stack"]:::observ
  end

  subgraph DATA_SERVICES["Optional Data Services"]
    postgres["PostgreSQL 17+"]:::infra
    redis["Redis Cache"]:::infra
    class postgres,redis optional
  end

  subgraph AI_PROVIDERS["External AI Providers"]
    openai["OpenAI GPT-4o"]:::ai
    gemini["Google Gemini"]:::ai
    claude["Anthropic Claude"]:::ai
    class openai,gemini,claude optional
  end

  haCore --> luciaComponent
  luciaComponent --> luciaApi
  appHost --> luciaApi
  appHost --> agentHost
  luciaApi --> agentHost
  luciaApi --> otelCollector
  agentHost --> otelCollector
  otelCollector --> logsStack
  luciaApi -.-> postgres
  agentHost -.-> redis
  agentHost -.-> openai
  agentHost -.-> gemini
  agentHost -.-> claude
